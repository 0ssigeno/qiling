language: shell
matrix:
  fast_finish: true
  include:   
    - name: "Windows WSL1"
      os: windows
      language: shell
      before_install:
        - curl -L -o ubuntu-1804.zip https://aka.ms/wsl-ubuntu-1804
        - powershell.exe -NoProfile -Command "Expand-Archive -Path ubuntu-1804.zip -DestinationPath Ubuntu"
        - Ubuntu/ubuntu1804.exe install --root
        - wsl.exe apt update
        - wsl.exe DEBIAN_FRONTEND=noninteractive apt dist-upgrade -y
        - wsl.exe DEBIAN_FRONTEND=noninteractive apt install -y python3-pip cmake
        - wsl.exe pip3 install --upgrade pip
      install:
        - wsl.exe pip3 install -r requirements.txt
        - wsl.exe python3 setup.py install
      before_script:
        #- wsl.exe /bin/bash -c "pysite=$(python3 -m sysconfig | sed -n '/purelib/ s/.*\= *//p' | xargs); cp ${pysite}${pysite}/keystone/libkeystone.so $pysite/keystone/"
        #- pysite1=$(wsl.exe python3 -c "import site; print(site.getsitepackages()[0])"); pysite2=$(wsl.exe python3 -c "import site; print(site.getsitepackages()[1])") && wsl.exe cp ${pysite1}${pysite2}/keystone/libkeystone.so $pysite1/keystone/
        #- wsl.exe cd tests
      script:
        - wsl.exe cd tests && python3 test_all.py
